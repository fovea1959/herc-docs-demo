

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Compressed Dasd Emulation &mdash; Hercules Documentation Demo 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Appendix A - Documentation Standards" href="appendix_a.html" />
    <link rel="prev" title="Supporting documentation" href="aa_auxdocs.html" />
    <link href="_static/herc_style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Hercules Documentation Demo
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hercinst.html">Building and Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="hercdasd.html">Creating DASD</a></li>
<li class="toctree-l1"><a class="reference internal" href="hercoper.html">Operating Procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="hercsupp.html">Technical Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="hercfaq.html">Frequently-Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html">Messages and Codes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="aa_auxdocs.html">Supporting documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Compressed Dasd Emulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#contents">Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shadow-files">Shadow Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-advantage-of-shadow-files">The Advantage of Shadow Files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#compressed-dasd-file-structure">Compressed DASD File Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-it-works">How It Works</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#reading">Reading</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing">Writing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#space-recovery">Space Recovery</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#runtime-tuning-options">Runtime tuning options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utilities">Utilities</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix_a.html">Appendix A - Documentation Standards</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Hercules Documentation Demo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="aa_auxdocs.html">Supporting documentation</a> &raquo;</li>
        
      <li>Compressed Dasd Emulation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/cckddasd.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="compressed-dasd-emulation">
<h1>Compressed Dasd Emulation<a class="headerlink" href="#compressed-dasd-emulation" title="Permalink to this heading">¶</a></h1>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#introduction">Introduction</a></p></li>
<li><p><a class="reference external" href="#shadowfiles">Shadow Files</a></p></li>
<li><p><a class="reference external" href="#filestructure">File Structure</a></p></li>
<li><p><a class="reference external" href="#howitworks">How It Works</a></p></li>
<li><p><a class="reference external" href="#cckdcommand">Tuning options</a></p></li>
<li><p><a class="reference external" href="#utilities">Utilities</a></p></li>
</ul>
</section>
<hr class="docutils" />
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>Using compressed DASD files can significantly reduce the host system
file space required for emulated DASD files and possibly provide a
performance gain as well because less physical I/O occurs.</p>
<p>Using compressed DASD files also has other advantages too, such as
allowing you to use <a class="reference external" href="#shadowfiles">shadow files</a>.</p>
<p>Both <strong>CKD</strong> (Count-Key-Data) and <strong>FBA</strong> (Fixed-Block-Architecture)
emulation files can be compressed.</p>
<p>In regular (or uncompressed) files, each CKD track or FBA block occupies
a specific spot in the emulation file. The offset of the track or block
in the file can be directly calculated knowing the track or block number
and the maximum size of the track or block. In compressed files, each
track image or group of blocks may be compressed by
<a class="reference external" href="http://www.zlib.net/">zlib</a> or <a class="reference external" href="http://www.bzip.org/">bzip2</a>, and
only occupies the space neccessary for the compressed data. The offset
of a compressed track or block is obtained by performing a two-table
lookup. The lookup tables themselves reside in the emulation file.</p>
<p>Because FBA blocks are 512 bytes in length, and that being a rather
small number, FBA blocks are thus grouped into <strong>block groups</strong>. Each
block group contains 120 FBA blocks (60K).</p>
<p>Whenever a track or block group is written to a compressed file, it is
written either to an existing free space within the file or at the end
of the file, the lookup tables are then updated, and then the space the
track or block group previously occupied is freed. The location of a
track or block group in the file can change many times.</p>
<p>In the event of a failure (for example, Hercules crash, operating system
crash or power failure), the compressed emulation file on the host’s
physical disk may be out of sync if the host operating system defers
physical writes to the file system containing the emulation file.
However, several methods have evolved to greatly reduce the chance of
this occurring as well as the amount of data loss that can occur after
these kinds of events, so the chance of actual data loss is relatively
small.</p>
<p>A compressed dasd image file may occupy only 20% of the disk space
required by an uncompressed file. In other words, you may be able to
have 5 times more emulated volumes on your system by using compressed
DASD files than by using uncompressed dasds. Compressed files are
slightly more sensitive to failures and data corruption however, but due
to their design and careful implementation, the chance of this actually
occuring is relatively small.</p>
<p>Compressed DASD images are created via the
<a class="reference external" href="hercload.html#dasdinit">dasdinit64</a> utility.</p>
</section>
<hr class="docutils" />
<section id="shadow-files">
<h2>Shadow Files<a class="headerlink" href="#shadow-files" title="Permalink to this heading">¶</a></h2>
<p>Shadow files are only supported for compressed dasd images.</p>
<p>A compressed CKD or FBA dasd can have more than one physical file. These
additional files are called <em>shadow files</em>. Shadow files are designed to
be used as a kind of <em>“snapshot”</em>, where a new shadow file can be
created on demand. An emulated dasd is represented by a <em>base</em> file and
0 or more shadow files. All files are opened <em>read-only</em> except for the
<em>current</em> file, which is opened <em>read-write</em>.</p>
<p>Shadow files are specified by the <strong>sf=</strong><em>shadow-file-name</em> parameter
on the device statement for the compressed DASD device.</p>
<p>Please note that the specified shadow filename does <em>not</em> have to
actually exist. The <em>shadow-file-name</em> operand of the <strong>sf=</strong> parameter
is simply a <strong>filename template</strong> that will be used to name the shadow
file whenever a shadow file is to be created. Shadow files do not
actually get created until you specifically create them via the
<code class="docutils literal notranslate"><span class="pre">sf+xxxx</span></code> (or <code class="docutils literal notranslate"><span class="pre">sf+*</span></code>) command, or automatically
<strong>(</strong><code class="docutils literal notranslate"><span class="pre">`*</span></code> &lt;#autoshadow&gt;`__<strong>)</strong> by marking either the base dasd
image file or an existing shadow file as read-only. Please refer to the
discussion of the <strong>sf</strong> command in the next section further below for
more information.</p>
<p>The <strong>shadow file name</strong> should have spot where the shadow file number
will be set. This is either the character immediately preceding the
filename extension or the last character of the file name itself if
there is no extension.</p>
<div class="line-block">
<div class="line">For example, the following device statement:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0001</span>  <span class="mi">2311</span>  <span class="n">AAAAAA</span><span class="o">.</span><span class="n">model</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">ext</span>   <span class="n">sf</span><span class="o">=</span><span class="n">AAAAAA_Shadow_0</span><span class="o">.</span><span class="n">model</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">ext</span>
</pre></div>
</div>
<p>will cause a shadow file with the following name to be created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AAAAAA_Shadow_0</span><span class="o">.</span><span class="n">model</span><span class="o">-</span><span class="mf">1.</span><span class="n">ext</span>
</pre></div>
</div>
<p>whereas the following <em>slightly different device statement</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0002</span>  <span class="mi">2311</span>  <span class="n">BBBBBB</span><span class="o">.</span><span class="n">model</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">ext</span>   <span class="n">sf</span><span class="o">=</span><span class="n">BBBBBB</span><span class="o">.</span><span class="n">model</span><span class="o">-</span><span class="n">x_Shadow_0</span><span class="o">.</span><span class="n">ext</span>
</pre></div>
</div>
<p>will cause a shadow file with the following name to be created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BBBBBB</span><span class="o">.</span><span class="n">model</span><span class="o">-</span><span class="n">x_Shadow_1</span><span class="o">.</span><span class="n">ext</span>
</pre></div>
</div>
<p><em>Notice the placement of the shadow file number</em> in the above two
examples: it is always immediately before the <em>last</em> period of the
filename. In earlier versions of Hercules the shadow file number was
erroneously placed immediately before the <em>first</em> period of the filename
instead of the last period. In newer versions of Hyperion this has been
corrected to place the number immediately before the <em>last</em> period, as
it was originally intended.</p>
<section id="the-advantage-of-shadow-files">
<h3>The Advantage of Shadow Files<a class="headerlink" href="#the-advantage-of-shadow-files" title="Permalink to this heading">¶</a></h3>
<p>A shadow file contains all the changes made to the emulated dasd since
it was created, until the next shadow file is created. The moment of the
shadow file’s creation can be thought of as a <em>“snapshot”</em> of the
current emulated dasd as it existed at that point in time, because if
the shadow file is later removed, then the emulated dasd reverts back to
the state it was in at the moment the snapshot was taken.</p>
<p>Using shadow files, you can keep the base file on a read-only device
such as cdrom, or change the base file attributes to read-only, ensuring
that this file can never be corrupted.</p>
<p>With the use of shadow files you can reconfigure your guest without
worrying about whether the new settings might render your guest
unusable. Simply create a new shadow file <em>before</em> you do your
reconfiguration. If something goes wrong, simply exit Hercules and then
delete that set of shadow files. You’ll be right back to where you were
<em>before</em> you made your changes! Then you can simply try again. Once you
are satisfied that your changes are good, you can then do a “<code class="docutils literal notranslate"><span class="pre">sf-*</span></code>”
backwards merge (see further below) to “commit” your changes.</p>
<p>There can be up to 8 shadow files in use at any time for an emulated
dasd device. The base file is designated file<strong>[0]</strong> and the shadow
files are file<strong>[1]</strong> to file<strong>[8]</strong>. The <em>highest</em> numbered file in
use at a given time is the <em>current</em> file, where all writes will occur.
Track reads start with the <em>current</em> file and proceeds downward until a
file is found that actually contains the track image.</p>
<p>Hercules console commands are provided to add a new shadow file, remove
the current shadow file (with or without backward merge), compress the
current shadow file, and display the shadow file status and statistics:</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><strong>sfd</strong></p></td>
<td><p>unit</p></td>
<td></td>
<td><p>Display shadow
file status and
statistics</p></td>
</tr>
<tr class="row-odd"><td><p><strong>sfc</strong></p></td>
<td><p>unit</p></td>
<td></td>
<td><p>Compress the
current file</p></td>
</tr>
<tr class="row-even"><td><p><strong>sf+</strong></p></td>
<td><p>unit</p></td>
<td></td>
<td><p>Create a new
shadow file
<strong>(</strong><code class="docutils literal notranslate"><span class="pre">`*</span></code> &lt;#autosh
adow&gt;`__<strong>)</strong></p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><strong>sf-</strong></p></td>
<td><p>unit</p></td>
<td><p>merge
<a href="#id1"><span class="problematic" id="id2">*</span></a>nomerge
force     *</p></td>
<td><p>Remove a shadow
file.
If <em>merge</em> is
specified or
defaulted, then
the contents of
the current
file is merged
into the
previous file,
the current
file is
removed, and
the previous
file becomes
the current
file. The
previous file
must be able to
be opened
read-write. If
<em>nomerge</em> is
specified then
the contents of
the current
file is
discarded and
the previous
file becomes
the current
file. However,
if the previous
file is
read-only, then
a new shadow
file is created
(re-added) and
that becomes
the current
file. The
<em>force</em> option
is required
when doing a
merge to the
base file and
the base file
is read-only
because the
<em>ro</em> option was
specified on
the device
config
statement.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><strong>sfk</strong></p></td>
<td><p>unit</p></td>
<td><p>level</p></td>
<td><p>Perform the
<strong>chkdsk</strong>
function on the
current file.
Level is a
number from -1
… 4, with the
default level
being <strong>2</strong>:
     -1
devhdr,
cdevhdr, L1
table.
      0
devhdr,
cdevhdr, L1
table, L2
tables.
      1
devhdr,
cdevhdr, L1
table, L2
tables, free
spaces.
      <strong>2</strong>
  devhdr,
cdevhdr, L1
table, L2
tables, free
spaces,
trkhdrs.
 <em>(default)</em>
      3
devhdr,
cdevhdr, L1
table, L2
tables, free
spaces,
trkimgs.
      4
devhdr,
cdevhdr, build
everything else
from recovery.</p></td>
</tr>
</tbody>
</table>
<p><em>Note</em>: You can use ‘<strong>``*``</strong>’ in place of ‘unit’ in any of the
above commands to apply the command to <em>all</em> compressed dasd.
(<code class="docutils literal notranslate"><span class="pre">sf+*</span></code>,<code class="docutils literal notranslate"><span class="pre">sf-*</span></code>,<code class="docutils literal notranslate"><span class="pre">sfc*</span></code>,<code class="docutils literal notranslate"><span class="pre">sfk*</span></code>,<code class="docutils literal notranslate"><span class="pre">sfd*</span></code>)</p>
<p><strong>(``*``)</strong> In addition to the <strong>sf+</strong> command, shadow files can also
be created <em>automatically</em> whenever the base dasd image and all of
its existing shadow files (if any) are marked as read-only. When
Hercules opens a compressed dasd image file with a <code class="docutils literal notranslate"><span class="pre">sf=</span></code> option, it
automatically looks for and opens whatever existing shadow files
there may be, with the highest numbered shadow file being the one
where all writes will occur. If the highest numbered shadow file is
also marked as a read-only file too, then a new shadow file is
automatically created and used instead.</p>
</div></blockquote>
</section>
</section>
<hr class="docutils" />
<section id="compressed-dasd-file-structure">
<h2>Compressed DASD File Structure<a class="headerlink" href="#compressed-dasd-file-structure" title="Permalink to this heading">¶</a></h2>
<p>A compressed DASD file has 6 types of spaces, a <em>device header</em>, a
<em>compressed device header</em>, a <em>primary lookup table</em>, <em>secondary lookup
tables</em>, track or block group <em>images</em>, and <em>free spaces</em>. The first 3
types (<em>device header, compressed device header, primary lookup table</em>)
only occur once, in order, at the very beginning of the file. The rest
of the file is occupied by the other 3 space types.</p>
<p><strong>It is also important to note</strong> <em>that, except for the actual track or
block group images space types, all numeric fields in each of the above
space types are always kept in LITTLE endian format and are
automatically converted to host format as needed before being used. This
is the complete opposite of the way emulated guest storage is maintained
(which is always in big endian format).</em></p>
<p>The very first 512 bytes of a compressed DASD file is the <strong>device
header</strong>. The device header contains an “eye-catcher” that identifies
the file type (32-bit or 64-bit CKD or FBA and base or shadow). The
original CCKD design used 32-bit file offset values thus limiting file
sizes to only 4GB or less.</p>
<p>The newer 64-bit design however, uses 64-bit offset values, thereby
allowing compressed dasd image files to grow up to the theoretical
maximum of 18,000,000 TB (18,000,000,000 GB). The <em>actual</em> maximum file
size however, is limited by both the operating system and the format of
whatever file system you are using. On Windows, using NTFS for example,
the maximum file size is limited to only 16 TB (16,000 GB).</p>
<blockquote>
<div><blockquote>
<div><p>Device-id
Dasd image type</p>
<p>CKD_P370
    Normal <em>(uncompressed)</em> CKD dasd image
CKD_C370
    Compressed CKD dasd image
CKD_S370
    Compressed CKD dasd Shadow file
n/a*
    Normal <em>(uncompressed)</em> FBA<strong>**</strong> dasd image
FBA_C370
    Compressed FBA dasd image
FBA_S370
    Compressed FBA dasd Shadow file</p>
<p>CKD_P064
    Normal <em>(uncompressed)</em> CKD64 dasd image
CKD_C064
    Compressed CKD64 dasd image
CKD_S064
    Compressed CKD64 dasd Shadow file
n/a*
    Normal <em>(uncompressed)</em> FBA64<strong>**</strong> dasd image
FBA_C064
    Compressed FBA64 dasd image
FBA_S064
    Compressed FBA64 dasd Shadow file</p>
</div></blockquote>
<p><em>(*)  Normal (uncompressed) FBA/FBA64 dasd image files do not have
device headers. The first 512 bytes of a normal (uncompressed)
FBA/FBA64 dasd image file is the actual first sector of the emulated
FBA dasd device itself.</em></p>
<p><em>(**)  Normal (uncompressed) FBA64 dasd image files are exactly
identical to normal (uncompressed) FBA dasd image files. There is
absolutely no distinction between the two types. Their formats are
exactly identical.</em></p>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">The device type and file size information is specified in this header
and, except for the eye-catcher (or device-id), this header is
identical for both compressed CCKD/CCKD64 and compressed CFBA/CFBA64
images as well as for uncompressed CKD/CKD64 images. As mentioned just
above however, it is <em>not</em> used for uncompressed FBA/FBA64 images.</div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>C
K
D
_
D
E
V
H
D
R</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>A</p></td>
<td><p>B</p></td>
<td><p>C</p></td>
<td><p>D</p></td>
<td><p>E</p></td>
<td><p>F</p></td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li></li>
</ul>
<p>C
K
D
_
C
3
7
0
*
*
“</p>
<p>(
d
e
v
i
c
e
-
i
d
o
r
”
e
y
e
-
c
a
t
c
h
e
r
”
)</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>d
h
_
h
e
a
d
s</p></td>
<td></td>
<td></td>
<td></td>
<td><p>d
h
_
t
r
k
s
i
z
e</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>d
h
_
d
e
v
t
y
p</p></td>
<td><p>d
h
_
f
i
l
e
s
e
q</p></td>
<td><p>d
h
_
h
i
g
h
c
y
l</p></td>
<td></td>
<td><p>d
h
_
s
e
r
i
a
l</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>r
e
s
e
r
v
e
d</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The <em>dh_heads</em>, <em>dh_trksize</em> and <em>dh_highcyl</em> values, being numeric, are
always kept in little endian format.</p>
<p>The next 512 bytes contains the <strong>compressed device header</strong>.</p>
<p>The compressed device header contains file usage information, such as
the amount of free space in the file.</p>
<p>Note that even though this control block is labeled “CCKD_DEVHDR” (or
“CCKD64_DEVHDR” for 64-bit images), it actually applies to (is used for)
compressed FBA images (CFBA/CFBA64) too, as well as for compressed CKD
images (CCKD/CCKD64).</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>C
C
K
D
_
D
E
V
H
D
R</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>A</p></td>
<td><p>B</p></td>
<td><p>C</p></td>
<td><p>D</p></td>
<td><p>E</p></td>
<td><p>F</p></td>
</tr>
<tr class="row-odd"><td><p>c
d
h
_
v
r
m</p></td>
<td></td>
<td></td>
<td><p>c
d
h
_
o
p
t
s</p></td>
<td><p>n
u
m
_
L
1
t
a
b</p></td>
<td></td>
<td></td>
<td></td>
<td><p>n
u
m
_
L
2
t
a
b</p></td>
<td></td>
<td></td>
<td></td>
<td><p>c
d
h
_
s
i
z
e</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>c
d
h
_
u
s
e
d</p></td>
<td></td>
<td></td>
<td></td>
<td><p>f
r
e
e
_
o
f
f</p></td>
<td></td>
<td></td>
<td></td>
<td><p>f
r
e
e
_
t
o
t
a
l</p></td>
<td></td>
<td></td>
<td></td>
<td><p>f
r
e
e
_
l
a
r
g
e
s
t</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>f
r
e
e
_
n
u
m</p></td>
<td></td>
<td></td>
<td></td>
<td><p>f
r
e
e
_
i
m
b
e
d</p></td>
<td></td>
<td></td>
<td></td>
<td><p>c
d
h
_
c
y
l
s</p></td>
<td></td>
<td></td>
<td></td>
<td><p>c
d
h
_
n
u
l
l
f
m
t</p></td>
<td><p>c
m
p
_
a
l
g
o</p></td>
<td><p>c
m
p
_
p
a
r
m</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>r
e
s
e
r
v
e
d</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>C
C
K
D
6
4
_
D
E
V
H
D
R</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>A</p></td>
<td><p>B</p></td>
<td><p>C</p></td>
<td><p>D</p></td>
<td><p>E</p></td>
<td><p>F</p></td>
</tr>
<tr class="row-odd"><td><p>c
d
h
_
v
r
m</p></td>
<td></td>
<td></td>
<td><p>c
d
h
_
o
p
t
s</p></td>
<td><p>n
u
m
_
L
1
t
a
b</p></td>
<td></td>
<td></td>
<td></td>
<td><p>n
u
m
_
L
2
t
a
b</p></td>
<td></td>
<td></td>
<td></td>
<td><p>c
d
h
_
c
y
l
s</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>c
d
h
_
s
i
z
e</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>c
d
h
_
u
s
e
d</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>f
r
e
e
_
o
f
f</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>f
r
e
e
_
t
o
t
a
l</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>f
r
e
e
_
l
a
r
g
e
s
t</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>f
r
e
e
_
n
u
m</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>f
r
e
e
_
i
m
b
e
d</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>c
d
h
_
n
u
l
l
f
m
t</p></td>
<td><p>c
m
p
_
a
l
g
o</p></td>
<td><p>c
m
p
_
p
a
r
m</p></td>
<td></td>
<td><p>r
e
s
e
r
v
e
d</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>r
e
s
e
r
v
e
d</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The <em>num_L1tab</em>, <em>num_L2tab</em>, <em>cdh_cyls</em>, <em>cdh_size</em>, <em>cdh_used</em>,
<em>free_off</em>, <em>free_total</em>, <em>free_largest</em>, <em>free_num</em>, <em>free_imbed</em>, and
<em>cmp_parm</em> values, being numeric, are always kept in little endian
format.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">After the compressed device header is the <strong>primary lookup table</strong>
(also called the Level 1 table or <em>L1tab</em>.) Each 4 byte unsigned entry
in the <em>L1tab</em> (8 byte unsigned entry for CCKD64) contains the file
offset of a <em>secondary lookup table</em> (or <em>level 2 table</em> or <em>L2tab</em>).</div>
</div>
<p>The track or block group number being accessed divided by 256 gives the
index into the <em>L1tab</em>. That is, each L1tab entry (<em>CCKD_L1ENT</em> or
<em>CCKD64_L1ENT</em>) represents 256 tracks or block groups. The number of
entries in the <em>L1tab</em> is dependent on the size of the emulated device.</p>
<p>Because each Level 1 table entry (CCKD_L1ENT or CCKD64_L1ENT) is a
numeric value, they are of course always kept in little endian format.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>C
C
K
D
_
L
1
T
A
B</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>C
C
K
D
_
L
1
E
N
T</p></td>
<td></td>
<td></td>
<td></td>
<td><p>C
C
K
D
_
L
1
E
N
T</p></td>
<td></td>
<td></td>
<td></td>
<td><p>C
C
K
D
_
L
1
E
N
T</p></td>
<td></td>
<td></td>
<td></td>
<td><p>C
C
K
D
_
L
1
E
N
T</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>A</p></td>
<td><p>B</p></td>
<td><p>C</p></td>
<td><p>D</p></td>
<td><p>E</p></td>
<td><p>F</p></td>
</tr>
<tr class="row-even"><td><p>L
1
</p>
<p>:
s
u
b
:
`
0
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
1
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
2
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
3
`</p>
</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>L
1
</p>
<p>:
s
u
b
:
`
4
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
5
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
6
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
7
`</p>
</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li></li>
<li></li>
</ul>
<p>.</p>
<p>.</p>
<ul class="simple">
<li></li>
</ul>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>L
1
</p>
<p>:
s
u
b
:
`
n
-
4
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
n
-
3
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
n
-
2
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
n
-
1
`</p>
</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>C
C
K
D
6
4
_
L
1
T
A
B</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>C
C
K
D
6
4
_
L
1
E
N
T</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>C
C
K
D
6
4
_
L
1
E
N
T</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>A</p></td>
<td><p>B</p></td>
<td><p>C</p></td>
<td><p>D</p></td>
<td><p>E</p></td>
<td><p>F</p></td>
</tr>
<tr class="row-even"><td><p>L
1
</p>
<p>:
s
u
b
:
`
0
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
1
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>L
1
</p>
<p>:
s
u
b
:
`
2
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
3
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>L
1
</p>
<p>:
s
u
b
:
`
4
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
5
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>L
1
</p>
<p>:
s
u
b
:
`
6
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
7
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li></li>
<li></li>
</ul>
<p>.</p>
<p>.</p>
<ul class="simple">
<li></li>
</ul>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>L
1
</p>
<p>:
s
u
b
:
`
n
-
4
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
n
-
3
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>L
1
</p>
<p>:
s
u
b
:
`
n
-
2
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>L
1
</p>
<p>:
s
u
b
:
`
n
-
1
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Following the primary lookup table (<em>L1tab</em>), in no particular order,
are: <strong>secondary lookup tables</strong> (<em>L2tabs</em>), <em>track or block group
images</em>, and <em>free spaces</em>.</div>
</div>
<p>Each <strong>secondary lookup table</strong> (or <em>L2tab</em>), contains 256 eight byte
entries (256 sixteen byte entries for CCKD64). The entry is indexed by
the remainder of the track or block group number divided by 256.</p>
<p>Each L2 entry contains an unsigned 4 byte <em>offset</em> (unsigned 8 byte
<em>offset</em> for CCKD64) to the <strong>track or block group image</strong> (<em>L2_trkoff</em>
= file offset to where the track image or block group begins), an
unsigned 2 byte track or block group <em>length</em> (the actual amount of data
contained on the track or in the block group) and an unsigned 2 byte
<em>size</em> of the track or block group image (i.e. how much space is
actually available for use at that particular file offset).</p>
<p>The length is the amount of available space currently being consumed by
the track or block group image, and the size is the amount of space
actually available. The size of course may be greater than the length to
prevent short free spaces from accumulating in the file.</p>
<p>Because each field in the Level 2 table (<em>L2_trkoff</em>, <em>L2_len</em> and
<em>L2_size</em>) is a numeric value, they are of course always kept in little
endian format.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>C
C
K
D
_
L
2
T
A
B</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>C
C
K
D
_
L
2
E
N
T</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>C
C
K
D
_
L
2
E
N
T</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>A</p></td>
<td><p>B</p></td>
<td><p>C</p></td>
<td><p>D</p></td>
<td><p>E</p></td>
<td><p>F</p></td>
</tr>
<tr class="row-even"><td><p>L
2
_
t
r
k
o
f
f
</p>
<p>:
s
u
b
:
`
0
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
2
_
l
e
n
</p>
<p>:
s
u
b
:
`
0
`</p>
</td>
<td></td>
<td><p>L
2
_
s
i
z
e
</p>
<p>:
s
u
b
:
`
0
`</p>
</td>
<td></td>
<td><p>L
2
_
t
r
k
o
f
f
</p>
<p>:
s
u
b
:
`
1
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
2
_
l
e
n
</p>
<p>:
s
u
b
:
`
1
`</p>
</td>
<td></td>
<td><p>L
2
_
s
i
z
e
</p>
<p>:
s
u
b
:
`
1
`</p>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li></li>
<li></li>
</ul>
<p>.</p>
<p>.</p>
<ul class="simple">
<li></li>
</ul>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>L
2
_
t
r
k
o
f
f
</p>
<p>:
s
u
b
:
`
2
5
4
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
2
_
l
e
n
</p>
<p>:
s
u
b
:
`
2
5
4
`</p>
</td>
<td></td>
<td><p>L
2
_
s
i
z
e
</p>
<p>:
s
u
b
:
`
2
5
4
`</p>
</td>
<td></td>
<td><p>L
2
_
t
r
k
o
f
f
</p>
<p>:
s
u
b
:
`
2
5
5
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td><p>L
2
_
l
e
n
</p>
<p>:
s
u
b
:
`
2
5
5
`</p>
</td>
<td></td>
<td><p>L
2
_
s
i
z
e
</p>
<p>:
s
u
b
:
`
2
5
5
`</p>
</td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>C
C
K
D
6
4
_
L
2
T
A
B</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>A</p></td>
<td><p>B</p></td>
<td><p>C</p></td>
<td><p>D</p></td>
<td><p>E</p></td>
<td><p>F</p></td>
</tr>
<tr class="row-odd"><td><p>C
C
K
D
6
4
_
L
2
E
N
T</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>L
2
_
t
r
k
o
f
f
</p>
<p>:
s
u
b
:
`
0
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>L
2
_
l
e
n
</p>
<p>:
s
u
b
:
`
0
`</p>
</td>
<td></td>
<td><p>L
2
_
s
i
z
e
</p>
<p>:
s
u
b
:
`
0
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>L
2
_
t
r
k
o
f
f
</p>
<p>:
s
u
b
:
`
1
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>L
2
_
l
e
n
</p>
<p>:
s
u
b
:
`
1
`</p>
</td>
<td></td>
<td><p>L
2
_
s
i
z
e
</p>
<p>:
s
u
b
:
`
1
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li></li>
<li></li>
</ul>
<p>.</p>
<p>.</p>
<ul class="simple">
<li></li>
</ul>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>L
2
_
t
r
k
o
f
f
</p>
<p>:
s
u
b
:
`
2
5
4
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>L
2
_
l
e
n
</p>
<p>:
s
u
b
:
`
2
5
4
`</p>
</td>
<td></td>
<td><p>L
2
_
s
i
z
e
</p>
<p>:
s
u
b
:
`
2
5
4
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>L
2
_
t
r
k
o
f
f
</p>
<p>:
s
u
b
:
`
2
5
5
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>L
2
_
l
e
n
</p>
<p>:
s
u
b
:
`
2
5
5
`</p>
</td>
<td></td>
<td><p>L
2
_
s
i
z
e
</p>
<p>:
s
u
b
:
`
2
5
5
`</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">A <strong>track image</strong> or <strong>block group image</strong> contains two fields: a
5-byte <em>header</em> and a variable amount of data that may or may not be
compressed. The length field in the secondary lookup table entry
(<em>L2_len</em> field shown just above) includes the length of both the
5-byte header as well as the track or block group data.</div>
</div>
<p>The 5-byte <em>track or block group header</em> contains a 1 byte compression
indicator and 4 bytes that identify the track or block group. The format
of the identifier depends on whether the emulated device is CKD or FBA:</p>
<p>CKD Track Header</p>
<p>0</p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>cmp</p>
<p>CC</p>
<p>HH</p>
<p>For <strong>CKD</strong>, the 2 byte CC is the cylinder number of the track image and
the HH is the head number. These numbers are stored in <em>big-endian</em> byte
order. When the compression indicator byte is zero the 5 byte header is
identical to the <em>Home Address</em> (or <em>HA</em>) for the track image.</p>
<p>The data — which may or may not be compressed — begins with the <em>R0</em>
count and ends with the <em>end-of-track</em> marker, which is a count field
containing <code class="docutils literal notranslate"><span class="pre">FFFFFFFFFFFFFFFF</span></code> (eight hex x’FF’s). The Home Address
plus the uncompressed track data comprise the track image.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>FBA Block Group Header</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>cmp</p></td>
<td><p>nnnnnnnn</p></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>For <strong>FBA</strong>, the 4 byte nnnnnnnn is the <em>big-endian</em> sector number of
the block group (i.e. the sector or block number of the first block in
the group). The block group data (the individual sectors in the block
group) — which may or may not be compressed (depending on the <em>cmp</em>
flag) — follows immediately after the block group header.</p>
<p>There is of course no end-of-track marker at the end of an FBA block
group. (FBA devices do not have tracks.)</p>
<p>Please note that, while the <em>FBA Block Group Header</em> is the first part
of the block group, it is <em>not</em> part of the compressed image. Only the
sectors themselves (which immediately follow the <em>Block Group Header</em>)
are actually compressed. FBA devices do not have Track Headers (Home
Addresses). The <em>FBA Block Group Header</em> should be considered an
internal structure and is never exposed to the guest.</p>
<p>The <strong>cmp</strong> compression indicator byte contains the value 0, 1 or 2. Any
other value is invalid:</p>
<p>0</p>
<p>   Data is uncompressed</p>
<p>1</p>
<p>   Data is compressed using zlib</p>
<p>2</p>
<p>   Data is compressed using bzip2</p>
<p>3…255</p>
<p>   (invalid)</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><strong>free space blocks</strong> which are <em>not</em> part of the <em>initial free space
chain table</em>, contain a 4 byte <em>offset</em> (8 bytes for CCKD64) to the
<em>next</em> free space, a 4 byte (or 8 byte) <em>length</em> of the free space
(which includes both the offset and length fields) and zero or more
bytes of undefined data.</div>
</div>
<p>The format of free space blocks which <em>are</em> part of the <em>initial free
space chain table</em> (used only during initialization of the internally
maintained free space chain) are formatted <em>slightly differently</em>. (see
further below)</p>
<p>The contents of the actual free space <em>data</em> is entirely unpredictable,
and can be anything from previous track data to previously used
secondary lookup tables, etc. From the programmer’s point of view it is
meaningless. It is just unpredictable/undefined file space.</p>
<p>The <em>fb_offnxt</em> and <em>fb_len</em> values, being numeric, are always kept in
little endian format:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>C
C
K
D
_
F
R
E
E
B
L
K</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p>
<p>.</p>
<p>.</p>
<p>.</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>f
b
_
o
f
f
n
x
t</p></td>
<td></td>
<td></td>
<td></td>
<td><p>f
b
_
l
e
n</p></td>
<td></td>
<td></td>
<td></td>
<td><p>d
a
t
a</p>
<p>.</p>
<p>.</p>
<p>.</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>d
a
t
a</p>
<p>.</p>
<p>.</p>
<p>.</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>C
C
K
D
6
4
_
F
R
E
E
B
L
K</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>A</p></td>
<td><p>B</p></td>
<td><p>C</p></td>
<td><p>D</p></td>
<td><p>E</p></td>
<td><p>F</p></td>
</tr>
<tr class="row-odd"><td><p>f
b
_
o
f
f
n
x
t</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>f
b
_
l
e
n</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>d
a
t
a</p>
<p>.</p>
<p>.</p>
<p>.</p>
</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The compressed device header’s <a class="reference external" href="#cdevhdr">free_off</a> field contains
the file offset to either the first actual free space block (which then
contains the offset to the next free space block, etc), or else the file
offset to a “new” format <em>initial free space chain table</em>, explained
further below.</p>
<p>The minimum length of a free space is 8 bytes (16 bytes for CCKD64). The
free space chain is ordered by file offset and no two free spaces are
adjacent. The chain is terminated when a free space block has zero
offset to the next free space.</p>
<p>Each free space block in the chain (or the entire “new” format <em>initial
free space chain table</em>) is read when the file is first opened for
read-write, and are written only when the file is closed. The free space
chain itself however, is maintained internally in storage while the file
is opened and the system is running.</p>
<p>The compressed device header <a class="reference external" href="#cdevhdr">free_off</a> field contains
either the offset to the first free space block in the chain, or else to
a “new” format <em>initial free space chain table</em>. The compressed device
header <a class="reference external" href="#cdevhdr">free_num</a> field contains the count of the total
number of free spaces there are in the chain.</p>
<p>Whenever a dasd image file is closed, a “new” format <em>initial free space
chain table</em> is written out to the first available free space block that
is large enough to hold the entire table (or to the end of the file if a
large enough free space block was not found).</p>
<p>The “new” format <em>initial free space chain table</em> allows quick
initialization of the internal in-storage free space chain since each
individual free space block does not need to read from disk. Instead,
the location and size of <em>all</em> available free spaces are read in <em>all at
once</em> from the initial free space chain table that was written out when
the file was closed.</p>
<p>The “new” format <strong>initial free space chain table</strong> is a table of
(contiguous series of) <strong>slightly modified free space blocks</strong>, wherein
the first block in the chain is a dummy block containing the 8-byte
literal “<strong>FREE_BLK</strong>” in ASCII, and where the remaining blocks in the
table are identical in format to the above documented <strong>free space
block</strong> layout, <em>with the following important exceptions:</em></p>
<ol class="arabic simple">
<li><p>The <em>fb_offnxt</em> field does <em>not</em> contain the file offset to the
<em>next</em> free space, but rather instead contains the file offset of the
<em>current</em> free space.</p></li>
<li><p>The <em>fb_len</em> field is itself accurate regarding the size (length) of
the free space at that offset, but the free space blocks in the table
themselves do not contain any actual free space <em>data</em>. That is to
say, each free space block in the table is exactly 8 bytes in size
(or 16 bytes for CCKD64).</p></li>
</ol>
<p>The number of free space blocks in the table is <em>one more</em> than the
compressed device header <a class="reference external" href="#cdevhdr">free_num</a> field to account for
the first dummy block containing the “FREE_BLK” literal.</p>
</section>
<hr class="docutils" />
<section id="how-it-works">
<h2>How It Works<a class="headerlink" href="#how-it-works" title="Permalink to this heading">¶</a></h2>
<section id="reading">
<h3>Reading<a class="headerlink" href="#reading" title="Permalink to this heading">¶</a></h3>
<p>A track or block group image is read while executing a channel program
or by the <em>readahead</em> thread. An image has to be read before it is
updated or written to. An image may be <em>cached</em>. If an image is cached,
then the channel program may complete <em>synchronously</em>. This means that
if all the data a channel program accesses is cached and Hercules does
not have to perform physical I/O, then the channel program runs
synchronously within the SSCH or SIO instruction in the <em>CPU</em> thread.
All DASD channel programs are started synchronously. If a CCW in the
channel program requires physical I/O then the channel program is
interrupted and restarted at that CCW <em>asynchronously</em> in a <em>device I/O</em>
thread.</p>
<p>All compressed devices share a common cache; the devices can be a
mixture of FBA and/or CKD device types. Each cache entry contains a
pointer to a 64K buffer containing an uncompressed track or block group
image. If the track or block group image being read is not found in the
cache, then the oldest (or <em>least recently used</em> or <em>LRU</em>) entry that is
not <em>busy</em> is <em>stolen</em>. A cache entry is busy if it is being read, or
last accessed by an <em>active</em> channel program, or updated but not yet
written, or being written. If no cache entries are available then the
read must enter a <em>cache wait</em>. When images are detected to be accessed
sequentially then the readahead thread(s) may be signalled to read
following sequential images.</p>
</section>
<section id="writing">
<h3>Writing<a class="headerlink" href="#writing" title="Permalink to this heading">¶</a></h3>
<p>When a cache entry is updated or written to, a bit is turned on
indicating the cache entry has been updated. When a <em>cache wait</em> occurs,
or (more likely) during space recovery, a cache <em>flush</em> is performed.
When the cache is flushed, if any entries have the updated bit on, then
the writer thread(s) are signalled. The writer thread selects the oldest
cache entry with the updated bit on, compresses the image, and writes it
to the file. The new image is written to a new space in the file and
then the space previously occupied by the image is freed. In certain
circumstances, the image may be written under <em>stress</em>. A stress write
occurs when a reading thread is in a <em>cache wait</em> or when a high
percentage of cache entries are pending write. In this circumstance, the
compression parameters are relaxed to reduce the CPU requirements. An
image written under stress is likely to take up more space than the same
image written not under stress. The writer thread(s) run 1 nicer than
the CPU thread(s); compression is a CPU intensive activity.</p>
</section>
<section id="space-recovery">
<h3>Space Recovery<a class="headerlink" href="#space-recovery" title="Permalink to this heading">¶</a></h3>
<p>Space recovery is also called, somewhat inaccurately, garbage
collection. The primary function of the space recovery thread, or
garbage collector, is to keep the emulated compressed DASD files as
small as possible. After all, that is the reason for using compressed
DASD files in the first place.</p>
<p>When a track or block group image is written, it is written to a new
location in the file. It is either written to an existing free space
within the file or to the end of the file, increasing the size of the
file. The space previously occupied by the image is freed, but it is not
immediately available for space allocation requests. Instead, it is
<em>pending</em> free space. It is assigned a <em>pending value</em> (typically 2)
that is decremented each space recovery cycle (typically every 10
seconds). When the pending value reaches 0 then the space is available
for allocation. This increases the chance that a track or block group
image can be recovered in the event of a failure.</p>
<p>The space recovery routine relocates track or block group images towards
the beginning of the file, causing free space to move towards the end of
the file. When a free space reaches the end of the file, it ‘falls off’,
that is, the file size is reduced.</p>
<p>Simply put, the space recovery routine first selects a space after a
sufficiently large <em>non-pending</em> free space. It then reads and writes
consecutive spaces using the normal cckd read and write routines. The
space read will become <em>pending</em> free space and will hopefully be
written to a <em>non-pending</em> free space occurring earlier in the file.
Sometimes it is necessary to write the space later in the file to
increase free space size earlier in the file. Left to itself, the space
recovery routine will eventually remove all free space from the file.
However, it is not intended to be a replacement for the <code class="docutils literal notranslate"><span class="pre">cckdcomp</span></code>
utility; rather, the intent is to provide sufficient free space to
prevent excessive file growth.</p>
<p>Another function performed by space recovery is to relocate <em>L2</em>
(secondary lookup) tables towards the beginning of the file. This
simplifies <em>chkdsk</em> recovery and enables the chkdsk function to complete
more quickly during initialization.</p>
<p>Interestingly however, this is actually <em>not recommended</em>, as it tends
to make accessing track data <em>slower</em>, not faster. Instead, L2 tables
should be kept as close as possible to the actual track data they point
to. Enabling automatic garbage collection is therefore <em>not recommended</em>
and is thus the reason it is disabled by default starting with Hercules
4.5.</p>
<p>Starting with Hercules 4.5, CCKD will (if <a class="reference external" href="#gcmsgs">gsmsgs</a>=1)
report the current garbage state (fragmentation state) of each dasd
image at startup so you can know which images you should perform manual
defragmentation for.</p>
</section>
</section>
<hr class="docutils" />
<section id="runtime-tuning-options">
<h2>Runtime tuning options<a class="headerlink" href="#runtime-tuning-options" title="Permalink to this heading">¶</a></h2>
<p>The <strong>cckd</strong> command and initialization statement can be used to affect
cckd processing. The <strong>CCKD</strong> initialization statement is specified as a
Hercules configuration file statement and supports the same options as
the <strong>cckd</strong> command explained below.</p>
<p><strong>Syntax:</strong></p>
<p><strong>cckd</strong></p>
<p><strong>help</strong></p>
<p>Display cckd help</p>
<p><strong>cckd</strong></p>
<p><strong>stats</strong></p>
<p>Display current cckd statistics</p>
<p><strong>cckd</strong></p>
<p><strong>opts</strong></p>
<p>Display current cckd options</p>
<p><strong>cckd</strong></p>
<p>opt=value</p>
<p>Set a cckd option.  Multiple options may be specified,</p>
<p>separated by a comma with no intervening blanks:</p>
<p><strong>comp=</strong>n</p>
<p>  Compression to be used</p>
<p><strong>compparm=</strong>n</p>
<p>  Compression parameter to be used</p>
<p><strong>debug=</strong>n</p>
<p>  Turn CCW tracing debug messages on or off</p>
<p><strong>freepend=</strong>n</p>
<p>  Set the free pending value</p>
<p><strong>fsync=</strong>n</p>
<p>  Turn fsync on or off</p>
<p><strong>gcint=</strong>n</p>
<p>  Garbage collector interval</p>
<p><strong>gcmsgs=</strong>n</p>
<p>  Garbage collector messages</p>
<p><strong>gcparm=</strong>n</p>
<p>  Garbage collector parameter</p>
<p><strong>gcstart=</strong>n</p>
<p>  Start garbage collector</p>
<p><strong>linuxnull=</strong>n</p>
<p>  Check for null linux tracks</p>
<p><strong>nosfd=</strong>n</p>
<p>  Turn off stats report at close</p>
<p><strong>nostress=</strong>n</p>
<p>  Turn stress writes on or off</p>
<p><strong>ra=</strong>n</p>
<p>  Number of readahead threads</p>
<p><strong>raq=</strong>n</p>
<p>  Readahead queue size</p>
<p><strong>rat=</strong>n</p>
<p>  Number of tracks to readahead</p>
<p><strong>trace=</strong>n</p>
<p>  Number of trace table entries</p>
<p><strong>wr=</strong>n</p>
<p>  Number of writer threads</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><strong>Options:</strong></div>
</div>
<p><strong>comp=</strong>n</p>
<div class="line-block">
<div class="line">Compression type:</div>
</div>
<div class="line-block">
<div class="line"><strong>-1</strong> Default</div>
<div class="line">**  0** None</div>
<div class="line">**  1** zlib</div>
<div class="line">**  2** bzip2</div>
</div>
<div class="line-block">
<div class="line">Override the compression used for all cckd files. -1 (default) means
don’t override the compression.</div>
</div>
<p><strong>compparm=</strong>n</p>
<div class="line-block">
<div class="line">Compression parameter. A value between -1 and 9. -1 means use the
default parameter. A higher value generally means more compression at
the expense of cpu and/or storage.</div>
</div>
<p><strong>debug=</strong>n</p>
<p>Enables or disables debug tracing. When enabled, additional CCKD trace
messages are displayed when CCW tracing is enabled for a CCKD dasd
device.</p>
<p>The default is <strong>0</strong> (disable CCKD trace mesages).</p>
<div class="line-block">
<div class="line">You can specify <strong>0</strong> (disable debug tracing) or <strong>1</strong> (enable debug
tracing).</div>
</div>
<p><strong>freepend=</strong>n</p>
<p>Specifies the <em>free pending</em> value for freed space. When a track or
block group image is written the space it previously occupied is freed.
This space will not be available for future allocations until <em>n</em>
garbage collection intervals have completed. In the event of a
catastrophic failure, previously written track or block group images
should be recoverable if the current image has not yet been written to
the physical disk. By default the value is set to <strong>-1</strong>. This means
that if <em>fsync</em> is specified then the value is 1 otherwise it is 2. If 0
is specified then freed space is immediately available for new
allocations.</p>
<p>The default is <strong>-1</strong>.</p>
<div class="line-block">
<div class="line">You can specify a number between <strong>-1</strong> and <strong>4</strong>.</div>
</div>
<p><strong>fsync=</strong>n</p>
<p>Enables or disables <em>fsync</em>. When fsync is enabled, then the disk
emulation file is synchronized with the physical hard disk at the end of
a garbage collection interval (however, no more often than 5 seconds).
This means that if <em>freepend</em> is non-zero then if a catastrophic error
occurs then the emulated disks <em>should</em> be recovered coherently.
However, fsync may cause performance degradation depending on the host
operating system and/or the host operating system level.</p>
<p>The default is <strong>0</strong> (fsync disabled).</p>
<div class="line-block">
<div class="line">You can specify <strong>0</strong> (disable fsync) or <strong>1</strong> (enable fsync).</div>
</div>
<p><strong>gcint=</strong>n</p>
<p>Number of seconds the garbage collector thread waits during an interval.
At the end of an interval, the garbage collector performs space
recovery, flushes the cache, and optionally <em>fsync</em>s the emulation
file. (However, the file will not be <em>fsync</em>ed unless at least 5
seconds have elapsed since the last <em>fsync</em>).</p>
<p>The default <em>(as of Hercules version 4.5)</em> is <strong>0</strong>, meaning automatic
garbage collection is disabled.</p>
<p>You can specify a number between <strong>0</strong> and <strong>60</strong>. A value of 0 disables
the default automatic behavior of the garbage collector, converting it
to manual on-demand mode instead. When in manual mode, the garbage
collector will only run by specific demand via the ‘gcstart’ option, and
once started, will only run through one garbage collection cycle and
then exit, requiring you to manually start it again when desired. In
automatic mode (gcint &gt; 0), the garbage collector will start itself
automatically and remain idle (but still running) between each garbage
collection cycle, automatically starting the next cycle every ‘gcint’
seconds.</p>
<div class="line-block">
<div class="line">It is recommended that this parameter remain set to its default value
of 0 in order to prevent the garbage collector from running
automatically. Rather, it is highly recommended that you manually
defragment your dasd images yourself before starting Hercules, via
either <code class="docutils literal notranslate"><span class="pre">cckdcomp</span></code> or <code class="docutils literal notranslate"><span class="pre">cckdcomp64</span></code> (<em>not recommended</em>) or
<a class="reference external" href="https://github.com/SDL-Hercules-390/hyperion/blob/master/readme/README.CCKD64.md">convto64</a>
instead (<em>recommended</em>).</div>
</div>
<p><strong>gcmsgs=</strong>n</p>
<p>Set to 1 to display garbage collector messages.</p>
<div class="line-block">
<div class="line">Set to <strong>0</strong> (the default) to suppress garbage collector messages.
Garbage collector messages are issued (if enabled) during each garbage
collection cycle as well as during startup to report the current
garbage state of each image.</div>
</div>
<p><strong>gcparm=</strong>n</p>
<p>A value affecting the amount of data moved during the garbage
collector’s space recovery routine. The garbage collector determines an
amount of space to move based on the ratio of free space to used space
in an emulation file, and on the number of free spaces in the file. (The
garbage collector wants to reduce the free space to used space ratio and
the number of free spaces).</p>
<p>The value is logarithmic; a value of 8 means moving 2<sup>8</sup> the
selected value, while a negative value similarly decreases the amount to
be moved. Normally, 256K will be moved for a file in an interval.
Specifying a value of +8 can increase the amount to 64M. At least 64K
will always be moved. Interestingly, specifying a large value (such as
+8) may not increase the garbage collection efficiency correspondingly.</p>
<p>The default is <strong>0</strong>.</p>
<div class="line-block">
<div class="line">You can specify any number between <strong>-8</strong> and <strong>+8</strong>.</div>
</div>
<p><strong>gcstart=</strong>n</p>
<p>If set to 1 then space recovery will become active on any emulated disks
that have free space. Normally space recovery will ignore emulated disks
until they have been updated.</p>
<div class="line-block">
<div class="line">The default is <strong>0</strong>.</div>
</div>
<p><strong>linuxnull=</strong>n</p>
<p>If set to 1 then tracks written to 3390 cckd volumes that were
initialized with the <em>-linux</em> option will be checked if they are null
(that is, if all 12 4096 byte user records contain zeroes). This is used
by the dasdcopy utility.</p>
<div class="line-block">
<div class="line">The default is <strong>0</strong>.</div>
</div>
<p><strong>nosfd=</strong>n</p>
<p>If set to 1 the shadow file status and statistics report will not be
displayed when the device is closed.</p>
<div class="line-block">
<div class="line">The default is <strong>0</strong>, meaning the shadow file status and statistics
report will be displayed like normal when the device is closed.</div>
</div>
<p><strong>nostress=</strong>n</p>
<p>Indicates whether <em>stress</em> writes will occur or not. A track or block
group may be written under stress when a high percentage of the cache is
pending write or when a device I/O thread is waiting for a cache entry.
When a stressed write occurs, the compression algorithm and/or
compression parm may be relaxed, resulting in faster compression but at
the expense of a slightly larger compressed image.</p>
<p>If <em>nostress</em> is set to one, then a stressed situation is ignored. You
would typically set this value to one when you want create the smallest
emulation file possible in exchange for a possible performance
degradation.</p>
<p>The default is <strong>0</strong>.</p>
<div class="line-block">
<div class="line">You can specify <strong>0</strong> (enable stressed writes) or <strong>1</strong> (disable
stressed writes).</div>
</div>
<p><strong>ra=</strong>n</p>
<p>Number of readahead threads. When sequential track or block group access
is detected, some number (<em>rat=</em>) of tracks or block groups are queued
(<em>raq=</em>) to be read by one of the readahead threads.</p>
<p>The default is <strong>2</strong>.</p>
<div class="line-block">
<div class="line">You can specify a number between <strong>1</strong> and <strong>9</strong>.</div>
</div>
<p><strong>raq=</strong>n</p>
<p>Size of the readahead queue. When sequential track or block group access
is detected, some number (<em>rat=</em> ) of tracks or block groups are queued
in the readahead queue.</p>
<p>The default is <strong>4</strong>.</p>
<div class="line-block">
<div class="line">You can specify a number between <strong>0</strong> and <strong>16</strong> (a value of zero
disables readahead).</div>
</div>
<p><strong>rat=</strong>n</p>
<p>Number of tracks or block groups to read ahead when sequential access
has been detected.</p>
<p>The default is <strong>2</strong>.</p>
<div class="line-block">
<div class="line">You can specify a number between <strong>0</strong> and <strong>16</strong> (a value of zero
disables readahead).</div>
</div>
<p><strong>trace=</strong>n</p>
<p>Number of cckd trace entries. You would normally specify a non-zero
value when debugging or capturing a problem in cckd code. When the
problem occurs, you should enter the <strong>k</strong> Hercules console command
which will print the trace table entries.</p>
<p>The default is <strong>64</strong>.</p>
<div class="line-block">
<div class="line">You can specify a number between <strong>0</strong> and <strong>200000</strong>. Each entry
represents 128 bytes. Normally, for debugging, I use 100000.</div>
</div>
<p><strong>wr=</strong>n</p>
<p>Number of writer threads. When the cache is <em>flushed</em> updated cache
entries are marked write pending and a writer thread is signalled. The
writer thread compresses the track or block group and writes the
compressed image to the emulation file. A writer thread is cpu-intensive
while compressing the track or block group and I/O-intensive while
writing the compressed image. The writer thread runs one <em>nicer</em> than
the CPU thread(s).</p>
<p>The default is <strong>2</strong>.</p>
<div class="line-block">
<div class="line">You can specify a number between <strong>1</strong> and <strong>9</strong>.</div>
</div>
</section>
<hr class="docutils" />
<section id="utilities">
<h2>Utilities<a class="headerlink" href="#utilities" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a href="#id3"><span class="problematic" id="id4">**</span></a>ckd2cckd  **</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a href="#id5"><span class="problematic" id="id6">**</span></a>cckd2ckd  **</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a href="#id7"><span class="problematic" id="id8">**</span></a>fba2cfba  **</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a href="#id9"><span class="problematic" id="id10">**</span></a>cfba2fba  **</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a href="#id11"><span class="problematic" id="id12">**</span></a>ckd2cckd64  **</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a href="#id13"><span class="problematic" id="id14">**</span></a>cckd642ckd  **</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a href="#id15"><span class="problematic" id="id16">**</span></a>fba2cfba64  **</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a href="#id17"><span class="problematic" id="id18">**</span></a>cfba642fba  **</p></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>These utilities are deprecated. Use the below
<strong>dasdcopy</strong> / <strong>dasdcopy64</strong> utility instead.</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a href="#id19"><span class="problematic" id="id20">**</span></a>dasdcopy  **</p></td>
<td><p><em>[-options] ifile [sf=sfile]
ofile</em></p></td>
</tr>
<tr class="row-even"><td><p><a href="#id21"><span class="problematic" id="id22">**</span></a>dasdcopy64  **</p></td>
<td><p><em>[-options] ifile [sf=sfile]
ofile</em></p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Copy / convert dasd image files
from one type to another.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>nested table here TODO fix</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p><strong>Note:</strong> <em>Any shadow file
specified as input is merged into
the output,</em></p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><em>rendering the input shadow file
obsolete once the copy
completes.</em></p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a href="#id23"><span class="problematic" id="id24">**</span></a>cckdcdsk  **</p></td>
<td><p><em>[-v] [-f] [-ro] [-level]
filename1 [filename2 …]</em></p></td>
</tr>
<tr class="row-even"><td><p><a href="#id25"><span class="problematic" id="id26">**</span></a>cckdcdsk64  **</p></td>
<td><p><em>[-v] [-f] [-ro] [-level]
filename1 [filename2 …]</em></p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Check the integrity and repair /
recover one or more damaged
compressed files.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>nested table here TODO fix</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a href="#id27"><span class="problematic" id="id28">**</span></a>cckdcomp  **</p></td>
<td><p><em>[-v] [-f] [-level] filename1
[filename2 …]</em></p></td>
</tr>
<tr class="row-even"><td><p><a href="#id29"><span class="problematic" id="id30">**</span></a>cckdcomp64  **</p></td>
<td><p><em>[-v] [-f] [-level] filename1
[filename2 …]</em></p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Remove all free space from a
compressed file or files.</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>nested table here TODO fix</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><strong>NOTE:</strong> <em>Use of the cckdcomp64
utility is discouraged. It is
recommended that you use
the</em><a class="reference external" href="https://github.com/SDL-Hercules-390/hyperion/blob/master/readme/README.CCKD64.md">convt
o64</a><em>utility
instead, as it is both faster and
much safer than cckdcomp64. If
you are still using 32-bit CCKD,
it is hightly recommended that
you convert all of your Hercules
dasds to the
new</em><a class="reference external" href="https://github.com/SDL-Hercules-390/hyperion/blob/master/readme/README.CCKD64.md">CC
KD64</a><em>format
instead.</em></p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a href="#id31"><span class="problematic" id="id32">**</span></a>cckdswap  **</p></td>
<td><p><em>[-v] [-f] [-level] filename1
[filename2 …]</em></p></td>
</tr>
<tr class="row-even"><td><p><a href="#id33"><span class="problematic" id="id34">**</span></a>cckdswap64  **</p></td>
<td><p><em>[-v] [-f] [-level] filename1
[filename2 …]</em></p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Change the <em>endianness</em> or
<em>byte-order</em> of a compressed file
or files</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>nested table here TODO fix</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="appendix_a.html" class="btn btn-neutral float-right" title="Appendix A - Documentation Standards" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="aa_auxdocs.html" class="btn btn-neutral float-left" title="Supporting documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl>
        <dt>Languages</dt>
        
           <strong> 
          <dd><a href="/herc-docs-demo/en/master/">en</a></dd>
           </strong> 
        
      </dl>
      
      
      <dl>
        <dt>Versions</dt>
        
          
          <dd><a href="/herc-docs-demo/en/fovea1959/">fovea1959</a></dd>
          
        
           <strong> 
          <dd><a href="/herc-docs-demo/en/master/">master</a></dd>
           </strong> 
        
          
          <dd><a href="/herc-docs-demo/en/0.0/">0.0</a></dd>
          
        
          
          <dd><a href="/herc-docs-demo/en/1.0/">1.0</a></dd>
          
        
      </dl>
      
      
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="/herc-docs-demo/en/master/Hercules Documentation Demo-docs_en_master.pdf">pdf</a></dd>
        
          <dd><a href="/herc-docs-demo/en/master/Hercules Documentation Demo-docs_en_master.epub">epub</a></dd>
        
          <dd><a href="/herc-docs-demo/en/master/Hercules Documentation Demo-docs_en_master.html.tar.gz">tarred HTML</a></dd>
        
          <dd><a href="/herc-docs-demo/en/master/Hercules Documentation Demo-docs_en_master.single.html.tar.gz">tarred single file HTML</a></dd>
        
      </dl>
      
      
      <hr/>
      <a href="https://tech.michaelaltfield.net/2020/07/18/sphinx-rtd-github-pages-1/">Continuous Documentation</a> hosting provided by <a href="https://pages.github.com/">GitHub Pages</a>.
 
    </div>
  </div>

 

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>